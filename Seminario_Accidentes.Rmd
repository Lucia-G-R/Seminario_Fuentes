---
title: "Seminario_Accidentes"
author: "Lorena Nerín y Lucía González"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# **Introdcucción**
Las enfermedades laborales

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```




Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


```{r}
# Instalar la librería readxl si no la tienes
#install.packages("readxl")
library(readxl)
```


```{r}
# URL cruda del archivo Excel en GitHub
url <- "https://github.com/Lucia-G-R/Seminario_Fuentes/blob/main/INPUT/DATA/Accidentes_laborales_Canarias.csv.csv"
```


```{r}
# Crear un archivo temporal para almacenar el Excel
temp <- tempfile(fileext = ".xlsx")
```


```{r, eval=FALSE}
# Descargar el archivo desde GitHub
download.file(https://datos.gob.es/es/catalogo/a02002834-accidentes-en-jornada-de-trabajo-n-de-accidentes-segun-grado-de-lesion-y-sexo, destfile = "INPUT/DATA/Accidentes_laborales_Canarias.csv.csv" , mode = "wb")
```

```{r}
#CARGA JSON CANARIAS
install.packages("rjson")
library(rjson)
canarias <- fromJSON(file = "INPUT/DATA/Accidentes_laborales_Canarias.json")

print(canarias)
```

```{r}
#CARGA XLS
install.packages("readxl")
library(readxl)
España <- read_excel("INPUT/DATA/Enfermedades_laborales_España.xls")
print(España)
```


```{r}
#CARGA CSV
install.packages("readr")
library(readr)
Salud <- read_delim ("INPUT/DATA/Estados_de_salud_Canarias.csv.csv", delim = ",")
print(Salud)
```

```{r}
#CARGA XLSX
install.packages("readxl")
library(readxl)
Aragon <- read_excel ("INPUT/DATA/070901-02_Por grado y sexo. Aragon.xlsx")
print(Aragon)
```

```{r}
#CAMBIAR NOMBRE COLUMNAS
colnames(canarias) <- c("Año", "Año2", "Sexo", "SexoCod", "Gravedad", "GravedadCod", "TipoTrab", "TipoTrabCod", "TrabHab", "TrabHabCod", "Obs")
#accidentes canarias

colnames(Aragon) <- c("Año", "Sexo", "NumAcci", "Gravedad", "GravedadCod", "CCAA")
#aragon

colnames(España) <- c("TipoEnf", "Indicador", "Sexo", "Obs")
#españa

colnames(Salud) <- c("Sexo", "Indicador","EstadoAnsiedad","Año","Obs")
#estado salud canarias

```

```{r}
ELIMINAR FILAS
# Eliminar filas usando subset()
mi_data4 <- subset(mi_data4, !(Sexo %in% c("De 16 a 64 años", "De 65 y más años")))

mi_data <- subset(mi_data, !(TipoTrabCod %in% c("4", "9", "_T", "3", "6", "0", "5", "1")))

mi_data3 <- subset(mi_data3, !(TipoEnf %in% c("Cardiopartía", "Dolor de cabeza", "infecciosa", "No sabe", "problema de salud", "Problema auditivo", "dermatológico", "gástrico", "respiratorio", "Total")))

# Eliminar filas usando grepl() para mi_data4
mi_data4 <- mi_data4[!grepl("De 16 a 64 años|De 65 y más años", Sexo), ]

# Eliminar filas usando grepl() para mi_data
mi_data <- mi_data[!grepl("4|9|_T|3|6|0|5|1", TipoTrabCod), ]

# Eliminar filas usando grepl() para mi_data3
mi_data3 <- mi_data3[!grepl("Cardiopartía|Dolor de cabeza|infecciosa|No sabe|problema de salud|Problema auditivo|dermatológico|gástrico|respiratorio|Total", TipoEnf), ]

```



# Descargar el archivo desde GitHub
download.file(url, destfile = temp, mode = "wb"

# Leer el archivo Excel desde el archivo temporal
mi_data <- read_excel(temp, sheet = 1)

# Eliminar el archivo temporal después de la lectura
unlink(temp)

# Verificar los primeros datos cargados
head(mi_data)